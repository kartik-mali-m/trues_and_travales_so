@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
}

@using ToursAndTravelsManagement.Helpers

@model IEnumerable<ToursAndTravelsManagement.Models.City>

@{
    ViewData["Title"] = "Manage Cities";
    Layout = "_AdminLayout"; // Or your admin layout
}

<div class="container-fluid">
    <!-- Header with Create button -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0 text-gray-800">
            <i class="fas fa-city mr-2"></i>Manage Cities
        </h1>
        <a asp-action="CreateCity" class="btn btn-primary">
            <i class="fas fa-plus-circle mr-1"></i> Add New City
        </a>
    </div>

    <!-- Success/Error Messages -->
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle mr-2"></i> @TempData["Success"]
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    }

    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-circle mr-2"></i> @TempData["Error"]
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                <span aria-hidden="true">&times;</span>
            </button>
        </div>
    }

    <!-- Cities Table -->
    <div class="card shadow mb-4">
        <div class="card-header py-3 d-flex justify-content-between align-items-center">
            <h6 class="m-0 font-weight-bold text-primary">
                <i class="fas fa-list mr-1"></i> All Cities (@Model.Count())
            </h6>
            <div class="dropdown">
                <button class="btn btn-outline-secondary btn-sm dropdown-toggle" type="button"
                        id="filterDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-filter mr-1"></i> Filter
                </button>
                <div class="dropdown-menu" aria-labelledby="filterDropdown">
                    <a class="dropdown-item" asp-action="ManageCities">All Cities</a>
                    <div class="dropdown-divider"></div>
                    <h6 class="dropdown-header">Popular Status</h6>
                    <a class="dropdown-item" href="?isPopular=true">Popular Only</a>
                    <a class="dropdown-item" href="?isPopular=false">Non-Popular Only</a>
                </div>
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                @if (Model.Any())
                {
                    <table class="table table-bordered table-hover" id="citiesTable" width="100%" cellspacing="0">
                        <thead class="thead-light">
                            <tr>
                                <th>#</th>
                                <th>
                                    <i class="fas fa-city mr-1"></i> City
                                </th>
                                <th>
                                    <i class="fas fa-map mr-1"></i> State/Country
                                </th>
                                <th>
                                    <i class="fas fa-info-circle mr-1"></i> Description
                                </th>
                                <th>
                                    <i class="fas fa-star mr-1"></i> Popular
                                </th>
                                <th>
                                    <i class="fas fa-cogs mr-1"></i> Actions
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            @{
                                int counter = 1;
                            }
                            @foreach (var city in Model)
                            {
                                <tr>
                                    <td>@counter</td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            @if (!string.IsNullOrEmpty(city.ImageUrl))
                                            {
                                                <img src="@city.ImageUrl"
                                                     class="img-thumbnail mr-3"
                                                     style="width: 50px; height: 50px; object-fit: cover;"
                                                     alt="@city.Name">
                                            }
                                            else
                                            {
                                                <div class="mr-3">
                                                    <i class="fas fa-city fa-2x text-secondary"></i>
                                                </div>
                                            }
                                            <div>
                                                <strong>@city.Name</strong>
                                                <div class="text-muted small">
                                                    @* Check if CreatedDate is not default (0001-01-01) *@
                                                    @if (city.CreatedDate.Year > 1)
                                                    {
                                                        <text>Added: @city.CreatedDate.ToString("dd MMM yyyy")</text>
                                                    }
                                                    else
                                                    {
                                                        <text>Date not available</text>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <div>@city.State</div>
                                        <div class="text-muted small">@city.Country</div>
                                    </td>
                                    <td>
                                        @if (!string.IsNullOrEmpty(city.Description))
                                        {
                                            @if (city.Description.Length > 50)
                                            {
                                                <span title="@city.Description">
                                                    @city.Description.Substring(0, 50)...
                                                </span>
                                            }
                                            else
                                            {
                                                @city.Description
                                            }
                                        }
                                        else
                                        {
                                            <span class="text-muted">No description</span>
                                        }
                                    </td>
                                    <td>
                                        @if (city.IsPopular)
                                        {
                                            <span class="badge badge-success">
                                                <i class="fas fa-star mr-1"></i> Popular
                                            </span>
                                        }
                                        else
                                        {
                                            <span class="badge badge-secondary">
                                                <i class="far fa-star mr-1"></i> Regular
                                            </span>
                                        }
                                    </td>
                                    <td>
                                        <div class="btn-group" role="group">
                                            <a asp-action="EditCity" asp-route-id="@city.CityId"
                                               class="btn btn-sm btn-outline-primary" title="Edit">
                                                <i class="fas fa-edit"></i>
                                            </a>
                                            <button type="button" class="btn btn-sm btn-outline-danger"
                                                    data-toggle="modal" data-target="#deleteModal-@city.CityId"
                                                    title="Delete">
                                                <i class="fas fa-trash-alt"></i>
                                            </button>
                                        </div>
                                    </td>
                                </tr>

                                <!-- Delete Confirmation Modal -->
                                <div class="modal fade" id="deleteModal-@city.CityId" tabindex="-1" role="dialog"
                                     aria-labelledby="deleteModalLabel-@city.CityId" aria-hidden="true">
                                    <div class="modal-dialog" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header bg-danger text-white">
                                                <h5 class="modal-title" id="deleteModalLabel-@city.CityId">
                                                    <i class="fas fa-exclamation-triangle mr-2"></i>Confirm Delete
                                                </h5>
                                                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                                                    <span aria-hidden="true">&times;</span>
                                                </button>
                                            </div>
                                            <div class="modal-body">
                                                <p>Are you sure you want to delete the city <strong>@city.Name</strong>?</p>
                                                <p class="text-danger">
                                                    <i class="fas fa-exclamation-circle mr-1"></i>
                                                    This action cannot be undone. All routes associated with this city will also be affected.
                                                </p>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-dismiss="modal">
                                                    <i class="fas fa-times mr-1"></i> Cancel
                                                </button>
                                                <form asp-action="DeleteCity" method="post">
                                                    <input type="hidden" name="id" value="@city.CityId" />
                                                    <button type="submit" class="btn btn-danger">
                                                        <i class="fas fa-trash-alt mr-1"></i> Delete
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                counter++;
                            }
                        </tbody>
                    </table>
                }
                else
                {
                    <div class="text-center py-5">
                        <div class="mb-4">
                            <i class="fas fa-city fa-4x text-muted"></i>
                        </div>
                        <h4 class="text-muted">No Cities Found</h4>
                        <p class="text-muted mb-4">Start by adding your first city to the system.</p>
                        <a asp-action="CreateCity" class="btn btn-primary">
                            <i class="fas fa-plus-circle mr-1"></i> Add Your First City
                        </a>
                    </div>
                }
            </div>
        </div>
    </div>
</div>

<div class="loading-overlay">
    <div class="loading-spinner"></div>
</div>

@section Scripts {
    <script>
        // $(document).ready(function () {
        //     // Initialize DataTable
        //     $('#citiesTable').DataTable({
        //         "pageLength": 10,
        //         "order": [[1, 'asc']], // Sort by city name
        //         "language": {
        //             "emptyTable": "No cities available",
        //             "search": "Search cities:",
        //             "paginate": {
        //                 "previous": "<i class='fas fa-chevron-left'></i>",
        //                 "next": "<i class='fas fa-chevron-right'></i>"
        //             }
        //         },
        //         "columnDefs": [
        //             { "orderable": false, "targets": [0, 4, 5] },
        //             { "searchable": false, "targets": [0, 4, 5] }
        //         ]
        //     });

        //     // Auto-dismiss alerts after 5 seconds
        //     setTimeout(function () {
        //         $('.alert').alert('close');
        //     }, 5000);
        // });


$(document).ready(function() {
    // Add hover effect to table rows
    $('#citiesTable tbody tr').hover(
        function() {
            $(this).addClass('table-hover-effect');
        },
        function() {
            $(this).removeClass('table-hover-effect');
        }
    );
    
    // Smooth scroll for filter dropdown
    $('.filter-dropdown a').on('click', function(e) {
        if (this.hash !== '') {
            e.preventDefault();
            const hash = this.hash;
            $('html, body').animate({
                scrollTop: $(hash).offset().top - 100
            }, 800);
        }
    });
    
    // Highlight newly added city
    if (window.location.hash === '#new-city') {
        setTimeout(function() {
            $('tr').last().addClass('highlight-new');
            $('html, body').animate({
                scrollTop: $('tr').last().offset().top - 200
            }, 1000);
            
            setTimeout(function() {
                $('tr').last().removeClass('highlight-new');
            }, 2000);
        }, 500);
    }
    
    // Confirmation before delete
    $(document).on('click', '.btn-delete', function(e) {
        if (!confirm('Are you sure you want to delete this city? This action cannot be undone.')) {
            e.preventDefault();
            e.stopPropagation();
            return false;
        }
    });
    
    // Loading overlay for form submissions
    $('form').on('submit', function() {
        $('.loading-overlay').addClass('active');
    });
    
    // Auto-hide alerts after 5 seconds
    setTimeout(function() {
        $('.alert').fadeTo(500, 0).slideUp(500, function() {
            $(this).remove();
        });
    }, 5000);
    
    // Close alert on click
    $('.alert .close').on('click', function() {
        $(this).closest('.alert').fadeOut();
    });
});
    </script>
}



<style>
  
    /* ==========================================================================
   Cities Management Page Styles
   ========================================================================== */

/* Page Header */
.city-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 10px;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    padding: 2rem;
    margin-bottom: 2rem;
    color: white;
}

.city-header h1 {
    font-weight: 600;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    margin-bottom: 0;
}

.city-header .btn-primary {
    background-color: rgba(255, 255, 255, 0.2);
    border-color: rgba(255, 255, 255, 0.3);
    color: white;
    transition: all 0.3s ease;
}

.city-header .btn-primary:hover {
    background-color: rgba(255, 255, 255, 0.3);
    border-color: rgba(255, 255, 255, 0.4);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

/* Card Styling */
.card {
    border: none;
    border-radius: 12px;
    box-shadow: 0 6px 15px rgba(0, 0, 0, 0.08);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    overflow: hidden;
}

.card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 25px rgba(0, 0, 0, 0.12);
}

.card-header {
    background: linear-gradient(to right, #f8f9fc, #e9ecef);
    border-bottom: 2px solid #dee2e6;
    padding: 1.25rem 1.5rem;
    border-radius: 12px 12px 0 0 !important;
}

.card-header h6 {
    font-weight: 600;
    color: #4e73df;
}

/* Filter Dropdown */
.filter-dropdown .dropdown-toggle {
    border-radius: 8px;
    border: 1px solid #ddd;
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
}

.filter-dropdown .dropdown-menu {
    border-radius: 8px;
    border: 1px solid #dee2e6;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    min-width: 200px;
}

.filter-dropdown .dropdown-item {
    padding: 0.5rem 1rem;
    transition: all 0.2s ease;
    border-radius: 4px;
}

.filter-dropdown .dropdown-item:hover {
    background-color: #4e73df;
    color: white;
    transform: translateX(5px);
}

/* Table Styling */
.table {
    margin-bottom: 0;
    font-size: 0.95rem;
}

.table thead th {
    background-color: #f8f9fc;
    color: #4e73df;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.85rem;
    letter-spacing: 0.5px;
    border-top: none;
    border-bottom: 2px solid #dee2e6;
    padding: 1rem 0.75rem;
    white-space: nowrap;
}

.table tbody tr {
    transition: all 0.3s ease;
    border-bottom: 1px solid #f0f0f0;
}

.table tbody tr:hover {
    background-color: rgba(78, 115, 223, 0.05);
    transform: scale(1.002);
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
}

.table tbody td {
    padding: 1.25rem 0.75rem;
    vertical-align: middle;
    border-top: 1px solid #f0f0f0;
}

/* City Image/Icon */
.city-image {
    width: 60px;
    height: 60px;
    object-fit: cover;
    border-radius: 8px;
    border: 2px solid #fff;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

.city-image:hover {
    transform: scale(1.1);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
}

.city-icon-placeholder {
    width: 60px;
    height: 60px;
    border-radius: 8px;
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
}

.city-info {
    min-height: 60px;
    display: flex;
    flex-direction: column;
    justify-content: center;
}

.city-name {
    font-weight: 600;
    color: #2d3748;
    font-size: 1.1rem;
    margin-bottom: 0.25rem;
}

.city-date {
    font-size: 0.85rem;
    color: #718096;
}

/* Badges */
.badge {
    padding: 0.4em 0.8em;
    font-size: 0.85rem;
    font-weight: 500;
    border-radius: 6px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    display: inline-flex;
    align-items: center;
    gap: 4px;
}

.badge-success {
    background: linear-gradient(to right, #38a169, #48bb78);
    border: none;
}

.badge-secondary {
    background: linear-gradient(to right, #a0aec0, #cbd5e0);
    border: none;
}

/* Action Buttons */
.action-buttons {
    display: flex;
    gap: 8px;
}

.btn-action {
    width: 36px;
    height: 36px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    border: 1px solid;
}

.btn-edit {
    background-color: rgba(66, 153, 225, 0.1);
    border-color: rgba(66, 153, 225, 0.3);
    color: #4299e1;
}

.btn-edit:hover {
    background-color: #4299e1;
    color: white;
    transform: translateY(-3px);
    box-shadow: 0 4px 8px rgba(66, 153, 225, 0.3);
}

.btn-delete {
    background-color: rgba(245, 101, 101, 0.1);
    border-color: rgba(245, 101, 101, 0.3);
    color: #f56565;
}

.btn-delete:hover {
    background-color: #f56565;
    color: white;
    transform: translateY(-3px);
    box-shadow: 0 4px 8px rgba(245, 101, 101, 0.3);
}

/* Modals */
.modal-content {
    border: none;
    border-radius: 12px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    overflow: hidden;
}

.modal-header {
    background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
    color: white;
    border-bottom: none;
    padding: 1.5rem;
}

.modal-title {
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 10px;
}

.modal-body {
    padding: 2rem;
    font-size: 1rem;
    line-height: 1.6;
}

.modal-footer {
    border-top: 1px solid #e9ecef;
    padding: 1rem 1.5rem;
    background-color: #f8f9fa;
}

/* Empty State */
.empty-state {
    padding: 4rem 2rem;
    text-align: center;
    background: linear-gradient(to bottom right, #f7fafc, #edf2f7);
    border-radius: 12px;
}

.empty-state-icon {
    font-size: 4rem;
    margin-bottom: 1.5rem;
    opacity: 0.7;
    background: linear-gradient(135deg, #a0aec0, #718096);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.empty-state-title {
    color: #4a5568;
    font-weight: 600;
    margin-bottom: 0.5rem;
}

.empty-state-description {
    color: #718096;
    margin-bottom: 2rem;
    max-width: 500px;
    margin-left: auto;
    margin-right: auto;
}

.empty-state-btn {
    padding: 0.75rem 2rem;
    border-radius: 8px;
    font-weight: 500;
    transition: all 0.3s ease;
}

/* Alerts */
.alert {
    border: none;
    border-radius: 10px;
    padding: 1rem 1.5rem;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    gap: 10px;
    border-left: 4px solid;
}

.alert-success {
    background-color: #f0fff4;
    border-left-color: #48bb78;
    color: #276749;
}

.alert-danger {
    background-color: #fff5f5;
    border-left-color: #f56565;
    color: #c53030;
}

/* Responsive Design */
@@media (max-width: 768px) {
    .city-header {
        padding: 1.5rem;
        text-align: center;
    }
    
    .city-header .d-flex {
        flex-direction: column;
        gap: 1rem;
    }
    
    .table-responsive {
        border: 1px solid #dee2e6;
        border-radius: 8px;
        overflow: hidden;
    }
    
    .action-buttons {
        flex-direction: column;
    }
    
    .btn-action {
        width: 32px;
        height: 32px;
    }
    
    .empty-state {
        padding: 3rem 1rem;
    }
}

/* Loading Animation (for async operations) */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(255, 255, 255, 0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
}

.loading-overlay.active {
    opacity: 1;
    visibility: visible;
}

.loading-spinner {
    width: 50px;
    height: 50px;
    border: 3px solid #f3f3f3;
    border-top: 3px solid #4e73df;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Hover effects for table rows */
.table-hover-effect tr {
    position: relative;
    cursor: pointer;
}

.table-hover-effect tr::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(90deg, rgba(78, 115, 223, 0.05) 0%, transparent 100%);
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
}

.table-hover-effect tr:hover::after {
    opacity: 1;
}

/* Custom scrollbar for table */
.table-responsive::-webkit-scrollbar {
    height: 8px;
    width: 8px;
}

.table-responsive::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
}

.table-responsive::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 4px;
}

.table-responsive::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
}

/* Animation for new city addition */
@@keyframes highlightNew {
    0% { background-color: rgba(72, 187, 120, 0.3); }
    100% { background-color: transparent; }
}

.highlight-new {
    animation: highlightNew 2s ease;
}

/* Tooltip customization */
.tooltip-inner {
    background-color: #2d3748;
    color: white;
    border-radius: 6px;
    padding: 0.5rem 0.75rem;
    font-size: 0.85rem;
}

.tooltip.bs-tooltip-top .arrow::before {
    border-top-color: #2d3748;
}

/* Print styles */
@@media print {
    .card-header,
    .action-buttons,
    .filter-dropdown {
        display: none !important;
    }
    
    .card {
        box-shadow: none !important;
        border: 1px solid #ddd !important;
    }
    
    .table {
        font-size: 12px;
    }
}



 </style>

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap4.min.css">
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap4.min.js"></script>